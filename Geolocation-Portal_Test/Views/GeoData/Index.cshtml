
@{
    ViewBag.Title = "Karte";
}

<h2>Index</h2>

@section Styles
{
    <script src='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.css' rel='stylesheet' />

    <style>
        #map {
            width: 100%;
            height: 800px;
        }
    </style>
}

<div style="display: flex; flex-direction: row;">
    <!-- flex-direction muss auf dem Smartphone auf column geändert werden. -->
    <div id='map'></div>

    <aside style="min-width: 250px; width: 30%; max-width: 350px; padding: 10px;">
        <h2 style="margin: 0; margin-bottom: 10px; padding: 0;">Datensätze:</h2>

        <!-- Alle Datensätze anzeigen -->
        <ul style="list-style-type: none; margin: 0; padding: 0; line-height: 1.4em;">
            <li><label><input type="checkbox" checked name="dataset1" value="bildungseinrichtungen">Bildungseinrichtungen (12)</input></label></li>
            <li><label><input type="checkbox" checked name="dataset2" value="bushaltestellen">Bushaltestellen (159)</input></label></li>
        </ul>
    </aside>
</div>

<script>
    L.mapbox.accessToken = "pk.eyJ1IjoibWlja3JlMTciLCJhIjoiY2s1ZjVtZ2czMmhleDNmbGo2N3d3dnp0eiJ9.CQfwridE_34CUIrMBQ-h1Q";

    var map = L.mapbox.map('map')
        .setView([49.348641, 9.142345], 13)
        .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'));

    /*
    L.geoJson("bildungseinrichtungen.geojson", {
        style: function (feature) {
            return {color: feature.properties.marker-color};
        },
        onEachFeature: function (feature, layer) {
            layer.bindPopup(feature.properties.Name);
        }
    }).addTo(map);
    */

    @{
        var dataFile = "~/App_Data/bildungseinrichtungen.geojson";
    }

    console.log("The dataFile Path: @dataFile");

    var myLayer = L.mapbox.featureLayer().loadURL("App_Data/bildungseinrichtungen.geojson").addTo(map);

    var myLayer = L.mapbox.featureLayer()
        .loadURL("<% = dataFile %>")
        .on('ready', function () {
            myLayer.eachLayer(function (layer) {
                map.fitBounds(myLayer.getBounds());
                layer.bindPopup(layer.features.properties.Name);
            });
        })
        .addTo(map);
</script>